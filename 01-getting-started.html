<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Vignette 1: Getting started</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">QDECR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01-getting-started.html">1. Getting started</a>
    </li>
    <li>
      <a href="02-quick-start.html">2. Quick start</a>
    </li>
    <li>
      <a href="03-using-qdecr.html">3. Using QDECR</a>
    </li>
    <li>
      <a href="04-post-processing.html">4. Post-processing</a>
    </li>
    <li>
      <a href="05-advanced-qdecr.html">5. Advanced QDECR</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Conference materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="data/qdecr_ohbm2019_poster.pdf">OHBM 2019 Poster (PDF)</a>
    </li>
    <li>
      <a href="data/qdecr_ohbm2019_brochure.pdf">OHBM 2019 Brochure (PDF)</a>
    </li>
    <li>
      <a href="ohbm2020.html">OHBM 2020 video + FAQ</a>
    </li>
    <li>
      <a href="data/qdecr_lmm.pdf">OHBM 2020 poster (PDF)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Contact &amp; Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://gitter.im/QDECR/questions">Asking questions</a>
    </li>
    <li>
      <a href="contribution.html">Contributing</a>
    </li>
    <li>
      <a href="about.html">About us</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/slamballais/QDECR">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Vignette 1: Getting started</h1>

</div>


<hr />
<div id="what-is-qdecr" class="section level1">
<h1><span class="header-section-number">1</span> What is <code>QDECR</code>?</h1>
<p><code>QDECR</code> is a tool that can be used to perform surface-based vertex-wise analyses in <code>R</code>.</p>
<hr />
</div>
<div id="requirements" class="section level1">
<h1><span class="header-section-number">2</span> Requirements</h1>
<p>In order to run <code>QDECR</code> you need to have several things ready:</p>
<ul>
<li>A Unix system. [see 2.1]</li>
<li><a href="https://surfer.nmr.mgh.harvard.edu/">Freesurfer</a> installed. [see 2.2]</li>
<li>Your images processed through Freesurfer with the <code>-qcache</code> flag. [see 2.3]</li>
<li><a href="https://www.r-project.org"><code>R</code></a> installed. [see 2.4]</li>
<li>A lot of other <code>R</code> packages that will be installed automatically. [see 2.4 or 3]</li>
<li>Make sure your target template (usually fsaverage) is in your <code>SUBJECTS_DIR</code> (directory with all your Freesurfer output). [see 2.5]</li>
</ul>
<p>We also highly suggest:</p>
<ul>
<li>Set <code>FREESURFER_HOME</code> and <code>SUBJECTS_DIR</code>; both can be set manually in QDECR, but it is more convenient. [see 4.1]</li>
<li><a href="https://www.imagemagick.org/Magick++/STL.html"><code>Magick++</code></a>; this is required for a specific plotting function (<code>qdecr_snap</code>) that you may or may not need. [see 2.6]</li>
<li>Get a better BLAS library like <a href="https://www.openblas.net/"><code>OpenBLAS</code></a> [see 2.7]</li>
</ul>
<div id="unix" class="section level2">
<h2><span class="header-section-number">2.1</span> Unix</h2>
<ul>
<li><strong>Unix</strong>: QDECR runs best with Unix.</li>
<li><strong>Windows</strong>: QDECR does not work on Windows. We rely on two functions from the Freesurfer suite that require Unix/Mac, and we use one function for parallel computing that does not work in Windows. Getting QDECR to work on Windows is not a strong priority for us.</li>
<li><strong>Mac</strong>: In theory, QDECR should also work on Mac, but we have not tested it yet.</li>
</ul>
</div>
<div id="install-freesurfer" class="section level2">
<h2><span class="header-section-number">2.2</span> Install Freesurfer</h2>
<p>To install Freesurfer, <a href="https://stackoverflow.com/questions/32530340/freesurfer-installed-on-ubuntu">follow this tutorial</a>, but change the <code>wget</code> command to the most up-to-date version of Freesurfer (<em>the tutorial downloads Freesurfer 5.3.0 which is NOT the newest version</em>).</p>
<p>An error may pop up down the line. Try opening <code>freeview</code> on the command line:</p>
<pre class="bash"><code>slamballais@scs:~$ freeview
freeview.bin:  error while loading shared libraries: libpng12.so.0: cannot open shared object file: No such file or directory.</code></pre>
<p>For Ubuntu 16.10 and higher this is a problem, as <code>libpng12.so.0</code> does not support those. There is an easy workaround:</p>
<pre class="bash"><code>wget -q -O /tmp/libpng12.deb http://mirrors.kernel.org/ubuntu/pool/main/libp/libpng/libpng12-0_1.2.54-1ubuntu1_amd64.deb \
  &amp;&amp; sudo dpkg -i /tmp/libpng12.deb \
  &amp;&amp; rm /tmp/libpng12.deb</code></pre>
</div>
<div id="run--qcache" class="section level2">
<h2><span class="header-section-number">2.3</span> Run -qcache</h2>
<p>Make sure that your subjects are run through Freesurfer with the <code>-qcache</code> flag, like this:</p>
<pre class="bash"><code>recon-all -s &lt;subject-id&gt; -qcache</code></pre>
<p>Full instructions can be found on the <a href="http://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/QdecGroupAnalysis_freeview">Freesurfer QDEC page</a>, under the header “pre-smoothed fsaverage surfaces”.</p>
</div>
<div id="install-r" class="section level2">
<h2><span class="header-section-number">2.4</span> Install R</h2>
<p>To install R on Ubuntu 18.04, <a href="https://www.digitalocean.com/community/tutorials/how-to-install-r-on-ubuntu-18-04">follow this tutorial</a> and <a href="https://www.digitalocean.com/community/tutorials/how-to-install-r-packages-using-devtools-on-ubuntu-18-04">run step 1 of this tutorial</a>.</p>
<p>QDECR relies on a lot of other R packages. These will be automatically installed when you install QDECR in R (see step 1.3).</p>
</div>
<div id="target-template-in-subjects_dir" class="section level2">
<h2><span class="header-section-number">2.5</span> Target template in SUBJECTS_DIR</h2>
<p>We need a target template to work with. After running <code>recon-all</code>, Freesurfer will make a symbolic link to <code>fsaverage</code> in SUBJECTS_DIR for you. However, if you imported data (e.g. if you download data) then you need to create that symbolic link yourself. This can be done easily through:</p>
<pre class="bash"><code>ln -sf $FREESURFER_HOME/subjects/fsaverage $SUBJECTS_DIR/</code></pre>
</div>
<div id="suggestion-magick" class="section level2">
<h2><span class="header-section-number">2.6</span> Suggestion: Magick++</h2>
<p><code>Magick</code> is a tool for image manipulation and is easy to install as described <a href="https://cran.r-project.org/web/packages/magick/vignettes/intro.html#build_from_source">here</a>.</p>
<p>For Debian/Ubuntu:</p>
<pre class="bash"><code>sudo apt-get install libmagick++-dev</code></pre>
<p>Consequently, in R:</p>
<pre class="r"><code>install.packages(&quot;magick&quot;)</code></pre>
</div>
<div id="suggestion-openblas" class="section level2">
<h2><span class="header-section-number">2.7</span> Suggestion: OpenBLAS</h2>
<p><code>QDECR</code> has to do a lot of linear algebra to run vertex-wise analyses. The good news is that we can speed that up by getting a better back-end library for linear algebra. You’ll have to install a BLAS library such as OpenBLAS. For Ubuntu 18.04, that would be:</p>
<pre class="bash"><code>sudo apt-get install libopenblas-base</code></pre>
<p>More information on BLAS libraries in R can be found <a href="https://csantill.github.io/RPerformanceWBLAS/">here</a>.</p>
<hr />
</div>
</div>
<div id="installing-qdecr" class="section level1">
<h1><span class="header-section-number">3</span> Installing QDECR</h1>
<p>First, we need to install the devtools package if it is not there yet:</p>
<pre class="r"><code>if (!requireNamespace(&quot;devtools&quot;))
  install.packages(&#39;devtools&#39;)</code></pre>
<p>Next, we have to grab the code from Github using the <code>install_github()</code> function:</p>
<pre class="r"><code>devtools::install_github(&quot;slamballais/QDECR&quot;)</code></pre>
<p>This should also download all dependent packages! This can take a while.</p>
<p>Finally, we can choose to attach the package to make it easier to use:</p>
<pre class="r"><code>library(QDECR)</code></pre>
<hr />
</div>
<div id="other-preparations" class="section level1">
<h1><span class="header-section-number">4</span> Other preparations</h1>
<div id="global-variables" class="section level2">
<h2><span class="header-section-number">4.1</span> Global variables</h2>
<p>QDECR assumes that you have set several global variables, namely <code>SUBJECTS_DIR</code> and <code>FREESURFER_HOME</code>. This is typically done when you configure Freesurfer, as described <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/SetupConfiguration_Linux">here</a>.</p>
<p>If you haven’t set the global variables yet and will use QDECR on from the command line, then you can modify your .bashrc file. The .bashrc file runs every time you open a terminal. Simply run:</p>
<pre class="bash"><code>echo &#39;export FREESURFER_HOME=/usr/local/freesurfer&#39; &gt;&gt; ~/.bashrc 
echo &#39;source $FREESURFER_HOME/SetUpFreeSurfer.sh&#39; &gt;&gt; ~/.bashrc</code></pre>
<p>If you want to directly use RStudio instead (so if you do not open it from the command line), use:</p>
<pre class="bash"><code>echo &#39;export FREESURFER_HOME=/usr/local/freesurfer&#39; &gt;&gt; ~/.profile
echo &#39;source $FREESURFER_HOME/SetUpFreeSurfer.sh&#39; &gt;&gt; ~/.profile</code></pre>
<p>You can check whether these variables are set by running the following <code>R</code> code:</p>
<pre class="r"><code>Sys.getenv(&quot;FREESURFER_HOME&quot;)
Sys.getenv(&quot;SUBJECTS_DIR&quot;)</code></pre>
<p>If these return empty strings, we highly recommend that you set up these variables (as described <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/SetupConfiguration_Linux">here</a>. However, QDECR also has some arguments that allow you to set them directly.</p>
</div>
<div id="subjects_dir" class="section level2">
<h2><span class="header-section-number">4.2</span> SUBJECTS_DIR</h2>
<p>The Freesurfer output directories should all be located in the same place, ideally the path that is stored by <code>SUBJECTS_DIR</code> (but this is optional). As of version 0.7.0 it is not possible to run analyses on participants spread over multiple directories.</p>
</div>
<div id="shared-memory-devshm" class="section level2">
<h2><span class="header-section-number">4.3</span> Shared memory (/dev/shm)</h2>
<p><strong>We highly recommend using shared memory for QDECR!</strong> As QDECR relies on file-backed matrices, we need to read and write a significant number of times to files. To avoid super slow analyses, it is advised to specify <code>dir_tmp = /dev/shm</code> in QDECR (see the next vignette).</p>
<hr />
<p>[Next vignette: <a href="02-quick-start.html">2. Quick start</a>]</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
